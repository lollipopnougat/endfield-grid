# 需求描述

请使用react和konva在此项目创建一个流水线布局小游戏

## 页面主体

页面主体是一个canvas网格，右上角有一个设置按钮，点击出现设置弹窗，可以设定网格的尺寸，默认70*70。

允许用户拖拽+鼠标滚轮缩放查看网格的不同区域。设置按钮旁边提供一个缩放网格以匹配屏幕尺寸的按钮，点击后使得网格缩放到可以完整被整个屏幕显示

用户可以在网格上放置“设备”，然后使用“流水线”将设备的输入口输出口连接起来

## 工具栏

页面底部提供一个工具栏，里面展示一个设备列表，可以选择拖放不同的“设备”，设备可以拖放到网格上，并自动对齐到网格线，不可以不按网格线放置，设备在canvas中展示为矩形框

### 设备类型

#### 2x2尺寸的设备

2x2尺寸的设备有供电桩和热能池两种

供电桩可以提供以自身为中心12x12范围的电力，选中供电桩时使用蓝色线条将这个范围的格子作为外描边标注出来，已经有供电的格子可以使用浅绿色作为背景色。
供电桩本身使用一个2x2正方形的天蓝色内接圆绘制

热能池四个边有一条边有两个输入口，其结构如下所示

```
>-
>-
```

请使用浅蓝色2x2矩形绘制热能池设备，并在输入口所在格子上方绘制黑色箭头指向输入方向

#### 3*3尺寸的设备

3x3设备均为生产设备，如果其所在格子没有被包含在供电桩的范围内，则需要将设备上绘制一个红色禁止图标

3x3尺寸的设备输入有三个口，输出也有三个口，输入口和输出口在一条线上，如下所示，左侧一列“>”均为输入，右侧一列“>”均为输出, “-”表示非输入输出口

```
>->
>->
>->
```

3x3的设备有以下这些

- 精炼炉 使用粉红色3x3矩形绘制
- 粉碎机 使用银色3x3矩形绘制
- 配件机 使用黄色3x3矩形绘制
- 塑形机 使用蓝色3x3矩形绘制

此外需要在设备输入输出对应的小格子中绘制输入和输出箭头指向对应方向

#### 4*6尺寸的设备

与3x3设备类似，此类型设备也是生产设备，只不过有6个输入口，6个输出口如下所示

```
>-->
>-->
>-->
>-->
>-->
>-->
```

此类型设备有

- 装备原件机 红色4x6矩形
- 灌装机 柠檬黄色4x6矩形
- 封装机 橄榄色4x6矩形
- 研磨机 紫色4x6矩形
- 拆解机 橘色4x6矩形

#### 6*6尺寸的设备

与4x6设备类似，此类型设备也是生产设备，也有6个输入口，6个输出口，相当于拉长了4x6设备的短边，其结构如下所示

```
>---->
>---->
>---->
>---->
>---->
>---->
```

此类型设备有

- 采种机 青色6x6矩形
- 种植机 棕色6x6矩形
- 反应池 品红色6x6矩形
- 天有洪炉 橄榄色6x6矩形

点击上述所有设备时进入设备编辑状态，展示编辑弹窗，弹窗上有移动、删除、旋转按钮。点击移动按钮设备自动跟随鼠标，可以重新放置（此时可以左键取消）。点击删除则会删除设备，点击旋转则顺时针旋转设备

### 其他元素

#### 流水线

用户可以点击使用工具栏中的流水线工具，点击后进入绘制流水线模式，此时可以在空白的格子上拖拽绘制流水线，流水线宽度1格，可以90度转弯，转弯时采用4分之1圆连接转弯处，流水线格子为金色，内部渲染黑色箭头代表方向。流水线不可以与设备重叠，不可以与其他流水线格子重叠，可从设备的输出口出发，连接到设备的输入口

点击流水线格子可以进入流水线编辑模式，出现编辑弹窗，有删除本格流水线和删除整条流水线按钮，点击执行对应功能

#### 流水线连接装置

下面这些都是 1x1 格连接元素

##### 流水线交叉桥

可以使用流水线交叉桥实现垂直的流水线交叉，格子内渲染一个黑色十字

如果绘制流水线发生交叉，在交叉处格子内自动生成一个流水线交叉桥

##### 流水线分流器

一条边是输入口，其余边均为输出口，请在格子内渲染三个共起点箭头，箭头末端分别指向三个输出口

##### 流水线合流器

一条边是输出口，其余边均为输入口，请在格子内渲染一个三叉共终点箭头，箭头前端分别从各个输入口开始

上述流水线工具都可以点击后进入编辑模式，出现弹窗显示移动、删除、旋转按钮，点击执行对应操作

## 保存和加载

请合理分析上述需求，设计数据结构，实现上述功能，此外可以保存绘制的图到json文件（保存按钮点击生成json），此外还提供一个按钮一键导入json加载已经保存的图